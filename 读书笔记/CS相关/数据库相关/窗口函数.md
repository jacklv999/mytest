## 窗口函数

#### Definition

##### Definition

Return same value for every row;

##### Usage

SQL_Func() OVER (partition by Col_Name(s) order by Col_Name(s))

- OVER: Key word for window function

- Partition by: the field used to group

  ```sql
  select *,avg(score) over (partition by class_name) as avg_math_score
  from All_Score
  ```

- Order by: 

  ```sql
  select *, rank() over(partition by class_name order by math_score desc) as rank_rank
  from score
  ```


- Rows:

> rows/rang between ... preceding and ... following 

- 必须和order by子句同时使用
  - 默认为RANGE BETWEEN unbounded preceding AND CURRENT ROW

- range是逻辑窗口，是指定当前行对应值的范围取值，列数不固定，只要行值在范围内，对应列都包含在内

  > SUM(ID) over(
  >
  > ​            ORDER BY ID 
  >
  > ​        RANGE BETWEEN 
  >
  > ​            1 preceding 
  >
  > ​        AND 
  >
  > ​            2 following
  >
  > ​        ) as range_sum

  - 当id=3时，是sum为3-1<=id<=3+2 的和，即sum=3（取id为3）

#### Specific Window Function

- row_number(): give id number for every row;
- rank(): ranking rows, but joint rank would have blank after it;
- dense_rank(): the same, but no blank rank;

#### Other Window Function

##### Sum

To calculate cumsum

```sql
select sum(num) over (
             order by rx
        ) as cumsum
from Numbers
```

